<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonicSpectrum - Advanced FFT Audio Analysis</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Roboto+Mono:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>

    <div class="app-container">

        <header>
            <div class="logo">
                <span class="logo-icon">â–²</span>
                <h1>SONIC<span class="accent">SPECTRUM</span></h1>
            </div>
            <div class="status-indicator" id="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">STANDBY</span>
            </div>
        </header>

        <main>
            <section class="visualizer-section">

                <div class="graph-container time-domain">
                    <div class="graph-header">
                        <h3>WAVEFORM <span class="unit">[Time Domain]</span></h3>
                    </div>
                    <canvas id="waveformCanvas"></canvas>
                </div>

                <div class="graph-container frequency-domain">
                    <div class="graph-header">
                        <h3>SPECTRUM <span class="unit">[Frequency Domain]</span></h3>
                    </div>
                    <canvas id="spectrumCanvas"></canvas>
                </div>

            </section>

            <section class="metrics-section">
                <div class="metric-card">
                    <h4>DOMINANT FREQ</h4>
                    <div class="metric-value" id="dominantFreq">0 <span class="unit">Hz</span></div>
                </div>
                <div class="metric-card">
                    <h4>PEAK DECIBEL</h4>
                    <div class="metric-value" id="peakDecibel">- <span class="unit">dB</span></div>
                </div>
                <!-- 
                     Modified: Added Sample Rate and Buffer Size per user request for "more technical stats" 
                -->
                <div class="metric-card">
                    <h4>NOTE ANALYSIS</h4>
                    <div style="display:flex; flex-direction:column; align-items:center; gap:2px;">
                        <div class="metric-value" id="musicalNote" style="font-size:2.5rem; color:var(--accent-blue);">
                            --</div>
                        <div style="font-size:0.9rem; color:#aaa; font-family:'Roboto Mono';">
                            <span id="noteFreqDetail">0</span> Hz | <span id="noteDbDetail">-</span> dB
                        </div>
                    </div>
                </div>
            </section>

            <div class="controls">
                <button id="startBtn" class="premium-btn start" title="Start listening and analyzing audio">
                    <span class="btn-icon">â–¶</span> INITIALIZE
                </button>
                <button id="pauseBtn" class="premium-btn pause" disabled
                    title="Pause analysis without finishing session">
                    <span class="btn-icon">â¸</span> PAUSE
                </button>
                <button id="stopBtn" class="premium-btn stop" disabled
                    title="Stop the analysis engine (Terminate Process)">
                    <span class="btn-icon">â– </span> TERMINATE
                </button>
                <button id="resetBtn" class="premium-btn reset" title="Clear all graphs and reset for a new person">
                    <span class="btn-icon">â†»</span> RESET
                </button>
                <button id="saveBtn" class="premium-btn save" disabled title="Save the current session to database">
                    <span class="btn-icon">ğŸ’¾</span> SAVE
                </button>

            </div>

            <section class="education-section">
                <h2>LOGIC GATE: <span class="accent">AUDIO ANALYSIS PHYSICS</span></h2>
                <div class="math-content">

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:2rem; margin-bottom:2rem;">
                        <div>
                            <h4 style="color:var(--accent-green); margin-bottom:0.5rem;">WAVEFORM vs SPECTRUM</h4>
                            <p><strong>Waveform (Sol Grafik):</strong> Sesin zamana gÃ¶re deÄŸiÅŸimini gÃ¶sterir. HoparlÃ¶rÃ¼n
                                ileri-geri hareketi gibidir. Ancak buradan hangi notanÄ±n Ã§alÄ±ndÄ±ÄŸÄ±nÄ± anlamak zordur.</p>
                            <br>
                            <p><strong>Spectrum (SaÄŸ Grafik):</strong> Sesin iÃ§indeki <em>frekanslarÄ±</em> gÃ¶sterir. "Bu
                                sesin iÃ§inde ne kadar Bas, ne kadar Tiz var?" sorusuna cevap verir. Bunu yapmak iÃ§in
                                <strong>FFT</strong> kullanÄ±lÄ±r.
                            </p>
                        </div>
                        <div>
                            <h4 style="color:var(--accent-blue); margin-bottom:0.5rem;">NEDEN FFT?</h4>
                            <p>Bilgisayarlar ham sesi (Waveform) anlar ama biz notalarÄ± (FrekanslarÄ±) duyarÄ±z.
                                <strong>Fast Fourier Transform (FFT)</strong>, karmaÅŸÄ±k bir ses dalgasÄ±nÄ± parÃ§alayarak
                                iÃ§indeki saf notalarÄ± (SinÃ¼s dalgalarÄ±nÄ±) ayÄ±klar. TÄ±pkÄ± bir prizmanÄ±n beyaz Ä±ÅŸÄ±ÄŸÄ±
                                renklere ayÄ±rmasÄ± gibidir.
                            </p>
                        </div>
                    </div>

                    <hr style="border-color: #333; margin: 1.5rem 0;">

                    <h3 style="margin-top:0;">FOURIER TRANSFORM DENKLEMÄ°</h3>
                    <p>Ham ses sinyalini (x) frekanslara (X) dÃ¶nÃ¼ÅŸtÃ¼ren formÃ¼lÃ¼n sade hali:</p>
                    <div class="equation-box">
                        <p class="equation">
                            X(k) = <span style="font-size:1.5em; vertical-align:middle;">&Sigma;</span>
                            x(n) &middot; e<sup>-i 2&pi; kn / N</sup>
                        </p>
                    </div>

                    <div class="explanation-grid">
                        <div class="exp-item">
                            <h4>x(n)</h4>
                            <p>Input Signal (Time Domain)</p>
                        </div>
                        <div class="exp-item">
                            <h4>X(k)</h4>
                            <p>Output Spectrum (Frequency Domain)</p>
                        </div>
                        <div class="exp-item">
                            <h4>N</h4>
                            <p>Number of Samples (FFT Size)</p>
                        </div>
                    </div>

                    <hr style="border-color: #333; margin: 1.5rem 0;">

                    <h3 style="margin-top:0;">MUSICAL NOTE (NOTA) NEDÄ°R?</h3>
                    <p>Her mÃ¼zik notasÄ± aslÄ±nda belirli bir <strong>Frekans (Hz)</strong> deÄŸeridir. Ã–rneÄŸin:</p>
                    <ul style="font-size:0.85rem; color:#888; margin-left:1.5rem; margin-top:0.5rem;">
                        <li><strong>A4 (La):</strong> 440 Hz standart akort frekansÄ±dÄ±r.</li>
                        <li><strong>C4 (Do):</strong> YaklaÅŸÄ±k 261 Hz'dir.</li>
                    </ul>
                    <p style="margin-top:0.5rem;">Sistem, sesinizdeki baskÄ±n frekansÄ± bulur ve matematiksel olarak en
                        yakÄ±n piyano tuÅŸuna (C, D, E...) dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r.</p>


                    <hr style="border-color: #333; margin: 1.5rem 0;">

                    <h3 style="margin-top:0;">NYQUIST-SHANNON TEOREMÄ°</h3>
                    <p>Dijital sesin kaliteli olmasÄ± iÃ§in Ã¶rnekleme hÄ±zÄ± (Sample Rate), yakalanmak istenen en yÃ¼ksek
                        sesin iki katÄ± olmalÄ±dÄ±r.</p>
                    <div class="equation-box">
                        <p class="equation">f<sub>s</sub> > 2 &middot; f<sub>max</sub></p>
                    </div>
                    <p><strong>Ã–rnek:</strong> Ä°nsan kulaÄŸÄ± en fazla 20.000 Hz (20kHz) duyar. Bu yÃ¼zden CD kalitesi
                        44.100 Hz'dir (20kHz'in 2 katÄ±ndan biraz fazla). Bu uygulama da sesi saniyede ~48.000 kere
                        dinler (Sample Rate).</p>

                    <hr style="border-color: #333; margin: 1.5rem 0;">

                    <h3 style="margin-top:0;">DESÄ°BEL (dB) NEDÄ°R?</h3>
                    <p>Sesin ÅŸiddetini (gÃ¼cÃ¼nÃ¼) Ã¶lÃ§en logaritmik bir birimdir. Dijital seste:</p>
                    <ul style="font-size:0.85rem; color:#888; margin-left:1.5rem; margin-top:0.5rem;">
                        <li><strong>0 dB (Maksimum):</strong> Sistemin alabileceÄŸi en yÃ¼ksek sesti (Clipping Point).
                            Bunun Ã¼stÃ¼ bozulma (cÄ±zÄ±rtÄ±) yapar.</li>
                        <li><strong>-6 dB:</strong> GenliÄŸin yarÄ±ya dÃ¼ÅŸmesidir.</li>
                        <li><strong>-100 dB:</strong> Neredeyse tam sessizliktir.</li>
                    </ul>
                    <p style="margin-top:0.5rem;">Grafikte yukarÄ± (0dB) ne kadar yakÄ±nsa, ses o kadar gÃ¼Ã§lÃ¼dÃ¼r.</p>
                </div>
            </section>

            <section class="saved-profiles-section" id="savedProfilesSection">
                <div class="section-header">
                    <h2>ARCHIVED ANALYSIS <span class="accent">DATABASE</span></h2>
                </div>
                <!-- Profiles will be injected here -->
                <div class="profiles-list" id="profilesList">
                    <div class="empty-state">No analysis saved yet.</div>
                </div>
            </section>

        </main>

        <footer>
            <p>SYSTEM STATUS: ONLINE // ANALYZING LOCAL AUDIO INPUT</p>
        </footer>

    </div>

    <!-- Save Modal -->
    <div id="saveModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>SAVE ANALYSIS RESULT</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Enter the subject's name to archive this voice profile.</p>
                <div class="input-group">
                    <input type="text" id="subjectName" placeholder="e.g. Arkim" autocomplete="off">
                </div>
                <div class="analysis-preview">
                    <p><strong>Voice Type:</strong> <span id="previewVoiceType">-</span></p>
                    <p><strong>Avg Freq:</strong> <span id="previewFreq">-</span> Hz</p>
                    <p><strong>Peak:</strong> <span id="previewDb">-</span> dB</p>
                </div>
                <button id="confirmSaveBtn" class="premium-btn">CONFIRM SAVE</button>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- Comparison Modal -->
    <div id="compareModal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px; width: 95%;">
            <div class="modal-header">
                <h3>SPECTRAL COMPARISON</h3>
                <span class="close-modal close-compare">&times;</span>
            </div>
            <div class="modal-body">
                <canvas id="comparisonCanvas"
                    style="width: 100%; height: 400px; background: #000; display: block;"></canvas>
                <div class="comparison-legend"
                    style="margin-top: 1rem; text-align: center; color: #888; font-family: monospace;">
                    Comparison of Frequency Dominance
                </div>
            </div>
        </div>
    </div>

    <script src="audio-engine.js"></script>
    <script src="visualizer.js"></script>
    <script src="app.js"></script>
</body>

</html>